name: CodeBuild - Build with GitHub Actions Runner

on: [push]

jobs:
  build:
    runs-on:
      - codebuild-github_runer-${{ github.run_id }}-${{ github.run_attempt }}

    steps:
      - name: ðŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      - name: ðŸ”§ Configurar cachÃ© npm
        uses: actions/cache@v4
        with:
          path: |
            ~/.npm
            frontend/node_modules
          key: ${{ runner.os }}-node-${{ env.NODE_VERSION }}-${{ hashFiles('frontend/package-lock.json', 'frontend/package.json') }}
          restore-keys: |
            ${{ runner.os }}-node-${{ env.NODE_VERSION }}-
            ${{ runner.os }}-node-

      - name: ðŸ“‹ Mostrar informaciÃ³n del ambiente
        run: |
          echo "ðŸ”§ InformaciÃ³n del Build:"
          echo "Node.js: $(node --version)"
          echo "npm: $(npm --version)"
          echo "Directorio: $(pwd)"

      - name: ðŸ“¦ Instalar dependencias
        working-directory: ./frontend
        run: |
          npm cache clean --force || true
          if [[ -f "package-lock.json" ]]; then
            npm ci --prefer-offline --no-audit
          else
            npm install --prefer-offline --no-audit
          fi

      - name: ðŸ§ª Ejecutar tests
        working-directory: ./frontend
        run: |
          npm test -- --coverage --watchAll=false --passWithNoTests

      # - name: ðŸ” Lint y verificaciones
      #   working-directory: ./frontend
      #   run: |
      #     if npm list eslint &>/dev/null; then
      #       npm run lint --if-present
      #     fi

      #     if [ -f "tsconfig.json" ]; then
      #       npx tsc --noEmit
      #     fi
